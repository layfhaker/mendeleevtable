# План-промпт: исправление багов на телефонах (волна тёмной темы, правый отступ, вертикальное центрирование)

Контекст: проект `mendeleevtable` (web/desktop + mobile layout). Нужно **точечно** исправить 3 проблемы на телефонах:

1. При переключении **в тёмную тему** круговая «волна» не заливает весь экран: тёмный цвет виден **только внутри плиток элементов**, а фон и промежутки (gaps) остаются «старыми»/светлыми.
2. Справа есть **некрасивый лишний отступ** (как будто справа “воздух”), даже когда это не край экрана.
3. Таблица на телефонах расположена **слишком высоко**: должна быть **по центру** (в пределах видимой области, с учётом нижней панели управления).

Ниже — план, рассчитанный на выполнение «по шагам», с контрольными точками и конкретными правками в файлах проекта.

---

## 0) Подготовка и быстрый repro (обязательно)

1) Запусти dev-сервер.
2) Открой сайт в Chrome DevTools → **Device Toolbar** (например: 360×800, DPR 2).
3) Проверь 3 кейса:
   - Переключение **Light → Dark** (кнопка темы), оцени: фон между плитками, общий фон страницы.
   - Визуально оцени правый «хвост»/отступ.
   - Оцени вертикальное положение таблицы относительно центра экрана и нижней панели.

**Цель**: после фиксов все 3 кейса должны проходить стабильно на размерах 320–430px шириной.

---

## 1) Фикс №1: «Волна в тёмную тему» не заливает фон и gaps

### 1.1. Точная причина (по проекту)
В `css/theme.css` задано:

```css
body.dark-theme {
    background-color: transparent;
}
```

Это **ломает идею заливки фона**: при включении `dark-theme` фон `body` становится прозрачным, поэтому тёмным выглядят только плитки `.element` (у них свой фон), а **gaps и общий фон** не перекрашиваются.

Дополнительно круг волны уходит в отрицательный z-index, а на мобилках canvas частиц поднимается в стек, что визуально усиливает “проступание” старого фона.

### 1.2. Правка (минимальная, точечная)
**Файл:** `css/theme.css`

Заменить:

```css
body.dark-theme {
    background-color: transparent;
}
```

на:

```css
body.dark-theme {
    background-color: #1a1a2e; /* тот же/согласованный цвет фона тёмной темы */
}
```

> Примечание: если у тебя фон тёмной темы задан переменными (например `--bg`), лучше подставить переменную (например `background-color: var(--bg);`), но в текущем коде уже используется тёмный цвет `#1a1a2e` в теме — поэтому можно зафиксировать его для начала.

### 1.3. Проверка
- Переключение **в тёмную тему**: тёмный фон должен быть **везде**, включая:
  - gaps между плитками,
  - область вокруг таблицы,
  - “пустой” фон страницы.

Если после этого всё равно видно странности именно у анимации круга, переходи к 1.4.

### 1.4. (Опционально) Уточнение по слою волны
**Файл:** `css/theme.css`

Найти `theme-wave-circle` (или аналогичный элемент волны). Убедиться, что z-index не уводит слой слишком глубоко, если требуется видеть круг поверх фона, но под UI.

Сейчас встречается:

```css
.theme-wave-circle {
    z-index: -2;
}
```

Рекомендация:
- либо держать волну **над фоном**, но **под таблицей**;
- либо вообще сделать волну `position: fixed; inset: 0; z-index: (выше фона, ниже UI)`.

Если после 1.2 уже всё работает — этот шаг можно не делать.

---

## 2) Фикс №2: лишний правый отступ на телефонах

### 2.1. Точные источники отступа (по проекту)
Правый “воздух” создаётся одновременно несколькими слоями:

1) **Сетка** (`css/table.css`):
```css
.container {
    margin-right: 20px; /* Отступ справа */
}
```

2) **Контейнер** (`css/scroll-collapse.css`):
```css
.periodic-table-container {
    padding: 0 20px; /* Добавляем отступы по бокам */
}
```

3) **Мобильный wrapper** создаётся inline-стилями (`js/modules/mobile-layout.js`, `ensureWrapper()`):
```js
padding-right: 20px;
```

Из-за суммарного эффекта появляется заметный правый отступ даже когда таблица уже “по месту”.

### 2.2. План правок (предпочтительный)
Нужно оставить **один** управляемый механизм отступов (например, только `padding` у контейнера), а остальное убрать на мобилках.

#### Шаг A — убрать margin-right на мобилках
**Файл:** `css/table.css`

Добавить моб. переопределение:

```css
@media (max-width: 1024px) {
  .container {
    margin-right: 0 !important;
  }
}
```

или удалить `margin-right: 20px` вовсе, если он не нужен нигде.

#### Шаг B — привести padding контейнера к разумному
**Файл:** `css/scroll-collapse.css`

На мобилках сделать меньше, например:

```css
@media (max-width: 1024px) {
  .periodic-table-container {
    padding-left: 12px;
    padding-right: 12px;
  }
}
```

> Если используется safe-area — добавь `env(safe-area-inset-left/right)` (см. 2.3).

#### Шаг C — убрать padding-right: 20px из wrapper
**Файл:** `js/modules/mobile-layout.js` → `ensureWrapper()`

В `wrapper.style.cssText = ...` убрать строку `padding-right: 20px;` (или заменить на `padding-right: 0;`).

Это самый “вредный” вклад, потому что он добавляет «хвост» даже при корректном центрировании/скролле.

### 2.3. (Рекомендуется) safe-area корректно
Если на некоторых телефонах появляются асимметрии из-за вырезов/жестовой области:

В `css/scroll-collapse.css` (или общий контейнерный стиль):

```css
@media (max-width: 1024px) {
  .periodic-table-container {
    padding-left: calc(12px + env(safe-area-inset-left));
    padding-right: calc(12px + env(safe-area-inset-right));
  }
}
```

### 2.4. Проверка
- На ширинах 320–430px **нет** постоянного правого «воздуха».
- Таблица визуально центрируется, и если есть горизонтальный скролл — он начинается “по делу”, а не из-за искусственного padding-right.

---

## 3) Фикс №3: таблица слишком высоко, нужна центровка по вертикали

### 3.1. Точные причины (по проекту)
1) В `css/base.css` на мобилках у `body` задан огромный нижний padding:

```css
body {
  padding: 10px 20px calc(140px + var(--sab)) 20px !important;
}
```

`140px` снизу **сильно сдвигает “оптический центр” вверх**.

2) В `js/modules/mobile-layout.js` мобильный wrapper принудительно позиционируется “сверху/слева”:

```css
align-self: flex-start;
transform-origin: top left;
margin-right: auto;
```

3) Есть конфликт трансформов:
- `centerTableVertically()` задаёт `wrapper.style.transform = translateY(...) scale(...)`
- `applyCalcActiveTransform()` задаёт другой transform для калькулятора/уравнителя

Это создаёт нестабильное положение на разных состояниях UI.

### 3.2. Минимальный фикс (быстрый и безопасный)
#### Шаг A — убрать 140px из padding-bottom body (на мобилках)
**Файл:** `css/base.css`

Заменить моб. правило:

```css
body {
  padding: 10px 20px calc(140px + var(--sab)) 20px !important;
}
```

на более мягкое, например:

```css
body {
  padding: 10px 20px calc(20px + var(--sab)) 20px !important;
}
```

> Идея: “резерв” под нижнюю панель должен задаваться не body, а конкретной панелью/контейнером, иначе страдает центрирование.

#### Шаг B — разрешить wrapper быть по центру (в обычном режиме)
**Файл:** `js/modules/mobile-layout.js` → `ensureWrapper()`

Убрать/изменить:
- `align-self: flex-start;` → лучше `align-self: center;` (или вообще не задавать)
- `margin-right: auto;` → убрать, если мешает центрированию

Если они нужны для режимов “скролл” — применять только в этих режимах (условно).

### 3.3. Правильная архитектура центрирования (если хочешь идеально)
Сделать разделение состояний:
- **Обычный режим:** контейнер центрирует таблицу через layout (flex/grid), wrapper без translateY.
- **Calc/балансер активен:** отдельный класс состояния добавляет нужный transform/offset, не конфликтуя с базовым.

Подход:
1) Ввести CSS-классы состояния (например `body.mobile-calc-active`).
2) В JS не перетирать `transform` в разных функциях, а:
   - хранить `scale` отдельно,
   - хранить `translate` отдельно,
   - собирать итоговый transform в одном месте (одна функция-источник истины).

### 3.4. Проверка
- На мобилке таблица визуально **по центру** “контентной области” (между верхними элементами и нижней панелью).
- При открытии калькулятора/фильтров положение не “скачет” и не уезжает вверх.

---

## 4) Контрольный чек-лист после фиксов

1) **Light → Dark**:
   - фон всей страницы тёмный (не только плитки),
   - gaps не выбиваются,
   - волна выглядит цельной.

2) **Отступ справа**:
   - нет постоянного “хвоста”,
   - нет горизонтального overflow без причины.

3) **Вертикальный центр**:
   - таблица находится по центру экрана,
   - нижняя панель не “выталкивает” таблицу вверх чрезмерно.

4) Прогон на нескольких размерах:
   - 320×700, 360×800, 412×915 (примерно).

---

## 5) Если нужен быстрый дифф-формат (опционально)
После применения шагов выше можно оформить изменения единым patch/commit’ом:
- `css/theme.css` — фон тёмной темы
- `css/table.css` — убрать `margin-right` на мобилках
- `css/scroll-collapse.css` — моб. padding + safe-area
- `js/modules/mobile-layout.js` — убрать `padding-right: 20px`, ослабить `flex-start`/auto margins
- `css/base.css` — уменьшить `padding-bottom` на мобилках

---

## 6) Готовые формулировки коммита (варианты)
- `fix(mobile): dark theme background fills gaps`
- `fix(mobile): remove extra right spacing`
- `fix(mobile): center table vertically and reduce body bottom padding`
